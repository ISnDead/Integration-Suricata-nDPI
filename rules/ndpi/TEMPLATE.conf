# ================================================================
# nDPI RULE TEMPLATE
# ---------------------------------------------------------------
# Purpose:
#   Detect network activity based on:
#     - protocol identified by nDPI (ndpi-protocol)
#     - risk level assigned by nDPI (ndpi-risk)
#
# Important notes:
#   - Rules must use only fields supported by the nDPI plugin in Suricata.
#   - Avoid content/file_data unless absolutely necessary — nDPI operates at flow/metadata level.
#   - SID must be unique and start from 9000000+ (reserved range for nDPI rules).
#   - Metadata is mandatory per PROCESS.md.
# ================================================================

# Example rule: detect high-risk traffic by protocol
alert tcp any any -> any any (
    msg:"[nDPI] <THREAT DESCRIPTION IN ENGLISH>"; \
    # Conditions required to activate rule via nDPI
    requires:keyword ndpi-protocol, keyword ndpi-risk; \
    # Specify exact nDPI protocol name (e.g., HTTP, TOR, STEAM, etc.)
    ndpi-protocol:<NDPI_PROTOCOL_NAME>; \
    # Specify risk label (e.g., NDPI_BINARY_APPLICATION_TRANSFER, NDPI_RISK_POTENTIALLY_UNWANTED)
    ndpi-risk:<NDPI_RISK_LABEL>; \
    # Unique rule ID (must be >= 9000000)
    sid:9000001; \
    # Rule revision (increment when logic changes)
    rev:1; \
    # Classification type (use existing or add to classification.config)
    classtype:attempted-recon; \
    # Metadata — REQUIRED for all rules (see PROCESS.md)
    metadata: \
        attack_target Client_Endpoint, \
        created_at YYYY_MM_DD, \
        deployment Perimeter, \
        updated_at YYYY_MM_DD, \
        mitre_tactic_id TAxxxx, \
        mitre_tactic_name <Tactic Name>, \
        mitre_technique_id Txxxx, \
        mitre_technique_name <Technique Name>;
)

# ================================================================
# ADDITIONAL GUIDELINES:
# 
# 1. To list available protocols and risk labels:
#      suricata --list-keywords | grep -i ndpi
#    or consult official nDPI documentation.
#
# 2. Do NOT use flowbits, file.data, content, etc. — they are unnecessary
#    if you rely solely on nDPI classification.
#
# 3. If you need to combine nDPI + payload inspection, create a separate rule
#    in rules/manual/, NOT in rules/ndpi/.
#
# 4. After writing a rule:
#    - Add a .pcap sample to test/pcaps/
#    - Fill FP/NP results in rules/ndpi/tests/table.csv
#    - Run validation: ./scripts/test-rule.sh
# 
